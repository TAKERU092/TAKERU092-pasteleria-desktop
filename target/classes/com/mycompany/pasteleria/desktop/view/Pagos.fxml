<?xml version="1.0" encoding="UTF-8"?>
<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.web.WebView?>

<VBox xmlns:fx="http://javafx.com/fxml"
      fx:controller="com.mycompany.pasteleria.desktop.controller.PagosController"
      spacing="12">
  <padding>
    <Insets top="16" right="16" bottom="16" left="16"/>
  </padding>

  <children>

    <!-- Top bar -->
    <ToolBar>
      <items>
        <Label text="Pagos (en revisión)" style="-fx-font-size:18; -fx-font-weight:bold;"/>
        <Separator/>
        <TextField fx:id="txtBuscar" promptText="Buscar N° pedido o método" prefWidth="300"/>
        <Button fx:id="btnBuscar" text="Buscar" onAction="#buscar" mnemonicParsing="false"/>
        <Button fx:id="btnRefrescar" text="Refrescar" onAction="#refrescar" mnemonicParsing="false"/>
        <Pane HBox.hgrow="ALWAYS"/>
      </items>
    </ToolBar>

    <!-- KPIs -->
    <HBox spacing="12" alignment="CENTER_LEFT">
      <children>
        <TitledPane text="Total" expanded="true">
          <content><Label fx:id="lblTotal" style="-fx-font-size:20; -fx-font-weight:bold;"/></content>
        </TitledPane>
        <TitledPane text="Página" expanded="true">
          <content><Label fx:id="lblPagina" style="-fx-font-size:20; -fx-font-weight:bold;"/></content>
        </TitledPane>
        <TitledPane text="Filtro" expanded="true">
          <content><Label fx:id="lblFiltro"/></content>
        </TitledPane>
        <Pane HBox.hgrow="ALWAYS"/>
      </children>
    </HBox>

    <!-- Centro: tabla | detalle -->
    <StackPane VBox.vgrow="ALWAYS">
      <children>
        <SplitPane dividerPositions="0.50">
          <items>

            <!-- Tabla -->
            <VBox spacing="8">
              <children>

                <TableView fx:id="tbl" editable="true" prefHeight="560" VBox.vgrow="ALWAYS">
                  <columns>
                    <!-- id_pago oculto (no se muestra) -->
                    <TableColumn fx:id="colIdPedido" text="N° Pedido" prefWidth="120"/>
                    <TableColumn fx:id="colMonto"    text="Monto"     prefWidth="140"/>
                    <TableColumn fx:id="colMetodo"   text="Método"    prefWidth="160"/>
                    <TableColumn fx:id="colEstado"   text="Estado"    prefWidth="160"/>
                    <TableColumn fx:id="colSubido"   text="Fecha"     prefWidth="200"/>
                  </columns>
                  <placeholder><Label text="No hay pagos en revisión."/></placeholder>
                </TableView>

                <HBox spacing="8" alignment="CENTER_RIGHT">
                  <children>
                    <Label fx:id="lblRango" text="Mostrando —"/>
                    <Button fx:id="btnPrev" text="Anterior" onAction="#paginaAnterior"/>
                    <Button fx:id="btnNext" text="Siguiente" onAction="#paginaSiguiente"/>
                  </children>
                </HBox>
              </children>
            </VBox>

            <!-- Detalle -->
            <VBox spacing="12">
              <children>

                <TitledPane text="Comprobante" expanded="true">
                  <content>
                    <BorderPane>
                      <center>
                        <WebView fx:id="webComprobante" prefHeight="420"/>
                      </center>
                      <bottom>
                        <HBox spacing="8" alignment="CENTER_RIGHT">
                          <padding>
                            <Insets top="8" right="8" bottom="8" left="8"/>
                          </padding>
                          <children>
                            <Label text="URL:"/>
                            <Label fx:id="lblUrl" maxWidth="Infinity"/>
                            <Pane HBox.hgrow="ALWAYS"/>
                            <Button text="Abrir en navegador" onAction="#abrirEnNavegador"/>
                          </children>
                        </HBox>
                      </bottom>
                    </BorderPane>
                  </content>
                </TitledPane>

                <TitledPane text="Comparativa" expanded="true">
                  <content>
                    <GridPane hgap="10" vgap="8">
                      <padding>
                        <Insets top="10" right="10" bottom="10" left="10"/>
                      </padding>
                      <columnConstraints>
                        <ColumnConstraints minWidth="120" percentWidth="40"/>
                        <ColumnConstraints minWidth="100" percentWidth="60"/>
                      </columnConstraints>
                      <children>
                        <Label text="Total pedido:" GridPane.rowIndex="0" GridPane.columnIndex="0"/>
                        <Label fx:id="lblTotalPedido" style="-fx-font-weight:bold;" GridPane.rowIndex="0" GridPane.columnIndex="1"/>

                        <Label text="Monto comprobante:" GridPane.rowIndex="1" GridPane.columnIndex="0"/>
                        <Label fx:id="lblMontoComprobante" style="-fx-font-weight:bold;" GridPane.rowIndex="1" GridPane.columnIndex="1"/>

                        <Label text="Diferencia:" GridPane.rowIndex="2" GridPane.columnIndex="0"/>
                        <Label fx:id="lblDiferencia" style="-fx-font-weight:bold;" GridPane.rowIndex="2" GridPane.columnIndex="1"/>
                      </children>
                    </GridPane>
                  </content>
                </TitledPane>

                <HBox spacing="8" alignment="CENTER_RIGHT">
                  <children>
                    <Label text="Cambiar estado (pedido):"/>
                    <Button fx:id="btnAprobar"   text="Aprobar"     onAction="#aprobar"/>
                    <Button fx:id="btnFaltoPago" text="Faltó pago"  onAction="#faltoPago"/>
                    <Button fx:id="btnCancelar"  text="Cancelar"    onAction="#cancelar"/>
                  </children>
                </HBox>

              </children>
            </VBox>

          </items>
        </SplitPane>

        <!-- Overlay -->
        <Region fx:id="shade" style="-fx-background-color: rgba(0,0,0,0.06);" visible="false" mouseTransparent="false"/>
        <ProgressIndicator fx:id="loader" visible="false" maxWidth="80" maxHeight="80" StackPane.alignment="CENTER"/>

      </children>
    </StackPane>

  </children>
</VBox>
