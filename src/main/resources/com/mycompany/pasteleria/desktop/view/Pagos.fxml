<?xml version="1.0" encoding="UTF-8"?>
<!-- RUTA: src/main/resources/com/mycompany/pasteleria/desktop/view/Pagos.fxml -->
<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.web.WebView?>

<VBox xmlns:fx="http://javafx.com/fxml"
      fx:controller="com.mycompany.pasteleria.desktop.controller.PagosController"
      spacing="12"
      styleClass="content">
  <padding><Insets top="12" right="12" bottom="12" left="12"/></padding>

  <children>

    <ToolBar styleClass="topbar">
      <items>
        <Label text="Aprobar pagos" styleClass="title"/>
        <Separator/>
        <TextField fx:id="txtBuscar" promptText="Buscar N° pedido o método" prefWidth="300"/>
        <Button fx:id="btnBuscar" text="Buscar" onAction="#buscar" mnemonicParsing="false"/>
        <Separator/>
        <Label text="Estado:" styleClass="label-muted"/>
        <ComboBox fx:id="cmbEstado" prefWidth="220" promptText="Seleccionar estado"/>
        <Button fx:id="btnRefrescar" text="Refrescar" onAction="#refrescar" mnemonicParsing="false" styleClass="btn-ghost"/>
        <Pane HBox.hgrow="ALWAYS"/>
      </items>
    </ToolBar>

    <StackPane VBox.vgrow="ALWAYS">
      <children>

        <SplitPane dividerPositions="0.52">
          <items>

            <!-- Tabla -->
            <VBox spacing="8">
              <children>

                <!-- OJO: sin columnResizePolicy aquí -->
                <TableView fx:id="tbl" editable="false" prefHeight="560" VBox.vgrow="ALWAYS">
                  <columns>
                    <TableColumn fx:id="colIdPedido" text="N° Pedido" prefWidth="120"/>
                    <TableColumn fx:id="colMonto"    text="Total"      prefWidth="140" styleClass="align-right"/>
                    <TableColumn fx:id="colMetodo"   text="Método"     prefWidth="160"/>
                    <TableColumn fx:id="colEstado"   text="Estado"     prefWidth="160" styleClass="align-center"/>
                    <TableColumn fx:id="colSubido"   text="Fecha"      prefWidth="200"/>
                  </columns>
                  <placeholder>
                    <Label text="No hay pagos para mostrar." styleClass="label-muted"/>
                  </placeholder>
                </TableView>

                <HBox spacing="8" alignment="CENTER_RIGHT">
                  <children>
                    <Label fx:id="lblRango" text="Mostrando —" styleClass="label-muted"/>
                    <Button fx:id="btnPrev" text="Anterior" onAction="#paginaAnterior" styleClass="btn-ghost"/>
                    <Button fx:id="btnNext" text="Siguiente" onAction="#paginaSiguiente"/>
                  </children>
                </HBox>
              </children>
            </VBox>

            <!-- Detalle -->
            <VBox spacing="12">
              <children>

                <TitledPane text="Comprobante" expanded="true">
                  <content>
                    <BorderPane>
                      <center><WebView fx:id="webComprobante" prefHeight="420"/></center>
                      <bottom>
                        <HBox spacing="8" alignment="CENTER_RIGHT">
                          <padding><Insets top="8" right="8" bottom="8" left="8"/></padding>
                          <children>
                            <Label text="URL:" styleClass="label-muted"/>
                            <Label fx:id="lblUrl" maxWidth="Infinity"/>
                            <Pane HBox.hgrow="ALWAYS"/>
                            <Button text="Abrir en navegador" onAction="#abrirEnNavegador" styleClass="btn-ghost"/>
                          </children>
                        </HBox>
                      </bottom>
                    </BorderPane>
                  </content>
                </TitledPane>

                <TitledPane text="Comparativa" expanded="true">
                  <content>
                    <GridPane hgap="10" vgap="8">
                      <padding><Insets top="10" right="10" bottom="10" left="10"/></padding>
                      <columnConstraints>
                        <ColumnConstraints minWidth="120" percentWidth="40"/>
                        <ColumnConstraints minWidth="100" percentWidth="60"/>
                      </columnConstraints>
                      <children>
                        <Label text="Total pedido:" GridPane.rowIndex="0" GridPane.columnIndex="0" styleClass="label-muted"/>
                        <Label fx:id="lblTotalPedido" style="-fx-font-weight:700;" GridPane.rowIndex="0" GridPane.columnIndex="1"/>
                        <Label text="Monto comprobante:" GridPane.rowIndex="1" GridPane.columnIndex="0" styleClass="label-muted"/>
                        <HBox spacing="8" GridPane.rowIndex="1" GridPane.columnIndex="1">
                          <children>
                            <TextField fx:id="txtMontoComprobante" promptText="Ej: 45.90" onAction="#guardarMontoComprobante" prefWidth="140"/>
                            <Button text="Guardar monto" onAction="#guardarMontoComprobante" styleClass="btn-emerald"/>
                          </children>
                        </HBox>
                        <Label text="Diferencia:" GridPane.rowIndex="2" GridPane.columnIndex="0" styleClass="label-muted"/>
                        <Label fx:id="lblDiferencia" style="-fx-font-weight:700;" GridPane.rowIndex="2" GridPane.columnIndex="1"/>
                      </children>
                    </GridPane>
                  </content>
                </TitledPane>

                <HBox spacing="8" alignment="CENTER_RIGHT">
                  <children>
                    <Button fx:id="btnAprobar" text="Aprobado" onAction="#aprobar" styleClass="btn-success"/>
                    <Button fx:id="btnPagoNoValido" text="Pago no válido" onAction="#pagoNoValido" styleClass="btn-danger"/>
                  </children>
                </HBox>

              </children>
            </VBox>

          </items>
        </SplitPane>

        <Region fx:id="shade" styleClass="overlay" visible="false" mouseTransparent="false"/>
        <ProgressIndicator fx:id="loader" visible="false" maxWidth="80" maxHeight="80" StackPane.alignment="CENTER"/>

      </children>
    </StackPane>

  </children>
</VBox>
